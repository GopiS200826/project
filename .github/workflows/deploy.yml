name: Sync Secrets to Railway

on:
  push:
    branches: [main]

jobs:
  sync-secrets:
    runs-on: ubuntu-latest
    
    steps:
    - name: Setup Railway CLI
      run: npm i -g @railway/cli
    
    - name: Sync Environment Variables
      env:
        RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        # GitHub Secrets
        ADMIN_PASSWORD: ${{ secrets.ADMIN_PASSWORD }}
        MYSQL_DB: ${{ secrets.MYSQL_DB }}
        MYSQL_HOST: ${{ secrets.MYSQL_HOST }}
        MYSQL_PASSWORD: ${{ secrets.MYSQL_PASSWORD }}
        MYSQL_USER: ${{ secrets.MYSQL_USER }}
        SUPER_ADMIN_PASSWORD: ${{ secrets.SUPER_ADMIN_PASSWORD }}
      run: |
        # Login
        railway login --token $RAILWAY_TOKEN
        
        # Update or create variables
        railway variables set ADMIN_PASSWORD="$ADMIN_PASSWORD"
        railway variables set MYSQL_DB="$MYSQL_DB"
        railway variables set MYSQL_HOST="$MYSQL_HOST"
        railway variables set MYSQL_PASSWORD="$MYSQL_PASSWORD"
        railway variables set MYSQL_USER="$MYSQL_USER"
        railway variables set SUPER_ADMIN_PASSWORD="$SUPER_ADMIN_PASSWORD"
        
        # Trigger a new deployment
        railway up --service your-service-name
